<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <meta name="generator" content="pandoc">
  
  <style type="text/css">code{white-space: pre;}</style>
  <link rel="stylesheet" href="/SE-Notes/style.css" type="text/css">
  <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_CHTML-full" type="text/javascript"></script>
<title>Modelling systems</title>
</head>
<body>

<h1 id="modelling-systems">Modelling systems</h1>
<a href="index.html">Back to se380</a>
<div id="TOC">

<ul>
<li>
<a href="#applying-known-laws-to-get-equations">Applying known laws to get equations</a><ul>
<li><a href="#e.g.-spring">e.g. Spring</a></li>
<li><a href="#e.g.-resistor">e.g. Resistor</a></li>
</ul>
</li>
<li>
<a href="#state-models">State models</a><ul><li><a href="#e.g.-cart">e.g. Cart</a></li></ul>
</li>
<li>
<a href="#generalizing">Generalizing</a><ul>
<li><a href="#e.g.-more-carts">e.g. more carts</a></li>
<li><a href="#e.g.-drones">e.g. drones</a></li>
<li><a href="#determining-state">Determining state</a></li>
<li><a href="#e.g.-cart-with-no-forces">e.g. cart with no forces</a></li>
<li><a href="#e.g.-2.5.2-pendulum">e.g. 2.5.2: Pendulum</a></li>
<li><a href="#e.g.-2.4.5-circuit">e.g. 2.4.5 Circuit</a></li>
</ul>
</li>
<li>
<a href="#linearization">Linearization</a><ul>
<li><a href="#e.g.-2.5.2">e.g. 2.5.2</a></li>
<li><a href="#e.g.-2.5.3">e.g. 2.5.3</a></li>
</ul>
</li>
<li>
<a href="#multivariable-taylor-series">Multivariable Taylor series</a><ul>
<li><a href="#e.g.-find-all-the-equilibria-at-which-the-pendulum-is-upright">e.g. Find all the equilibria at which the pendulum is upright</a></li>
<li><a href="#summary">Summary</a></li>
</ul>
</li>
</ul>
</div>
<p><img src="img/dynamicsystem.png"></p>
<ol>
<li>Apply known laws to get a system of differential equations</li>
<li>Linearize the model at an operating point to get a system of linear equations</li>
<li>Take the Laplace transform with zero initial conditions to get a system of linear algebraic equations</li>
<li>Isolate input and output to get a transfer function</li>
<li>Experimentally determine parameter values for the transfer function (e.g. weight of your robot)</li>
</ol>
<h2 id="applying-known-laws-to-get-equations">Applying known laws to get equations</h2>
<h3 id="e.g.-spring">e.g. Spring</h3>
<p><img src="img/spring.png"></p>
<p><span class="math inline">\(q \in \mathbb{R}\)</span> is the position of the mass M</p>
<p><span class="math inline">\(\dot{q} := \frac{dq}{dt}, \quad \ddot{q} := \frac{d^2q}{dt^2}\)</span></p>
<p>Assume that <span class="math inline">\(q=0\)</span> corresponds to the mass location at which the spring is neither stretched nor compressed.</p>
<p>Newton's 2nd law: <span class="math inline">\(M\ddot{q} = \sum{ \text{forces acting on } M}\)</span></p>
<p>Force due to spring: <span class="math inline">\(F_K(q) = Kq\)</span>, assumed to be linear</p>
<p>Force due to damper, possibly nonlinear: <span class="math inline">\(C(\dot{q})\)</span></p>
<p>Altogether, we get a second order nonlinear ODE:<br>
<span class="math display">\[M\ddot{q} = -Kq - C(\dot{q}) + u\]</span></p>
<p>Note: if the damper is linear (<span class="math inline">\(C(\dot{q})=bq\)</span>), then the overall system is linear</p>
<h3 id="e.g.-resistor">e.g. Resistor</h3>
<p><img src="img/resistor.png"></p>
<p><span class="math inline">\(V_R(t) = h(i(t)), \quad h : \mathbb{R} \rightarrow \mathbb{R}\)</span> is possibly nonlinear</p>
<p><span class="math inline">\(u(t)\)</span>: applied voltage; <span class="math inline">\(y(t)\)</span>: voltage across capacitor</p>
<p>Apply Kirchoff's Voltage Law:<br>
<span class="math display">\[\begin{align}
-u(t) + V_R + y &amp;= 0\\
\\
i(t) &amp;= C\frac{dy}{dt} \quad \text{(capacitor equation)}\\
V_R &amp;= h(i(t)) = h(C\dot(y))\\
\\
-u(t) + h(C\dot{y}) + y &amp;= 0\\
\end{align}\]</span></p>
<p>Note: if the resister were linear (<span class="math inline">\(h(i) = Ri\)</span>), the whole system would be linear (see 2.3.4 in notes)</p>
<h2 id="state-models">State models</h2>
<h3 id="e.g.-cart">e.g. Cart</h3>
<p><img src="img/carairresistance.png"></p>
<p>Newton's second law: <span class="math inline">\(M\ddot{y} = u - D(\dot{y})\)</span></p>
<p>We put this model into a standard form by defining two <strong>state variables</strong>:<br>
<span class="math display">\[x_1 := y \text{ (position)}, \quad x_2 := \dot{y} \text{ (velocity)}\]</span></p>
<p>Together, <span class="math inline">\(x_1\)</span> and <span class="math inline">\(x_2\)</span> make up the <strong>state</strong> of the system. We do some rewriting to have a systematic way to do linearization:</p>
<p><span class="math display">\[\begin{align}
\dot{x_1} &amp;= x_2 &amp; \text{(state equation)}\\
\dot{x_2} &amp;= \frac{1}{M}u - \frac{1}{M}D(x_2) &amp; \text{(state equation)}\\
y &amp;= x_1 &amp; \text{(output equation)}\\
\end{align}\]</span></p>
<p>Together, these equations make up the <strong>state-space model.</strong> These equations have the general form:</p>
<p><span class="math display">\[\dot{x} = f(x,u) \text{ where } y = h(x)\]</span></p>
<p>In this example:</p>
<p><span class="math display">\[\begin{align}
X &amp;= (x_1, x_2) \in \mathbb{R}^2\\
f(x,u) &amp;= \begin{bmatrix}
x_2 \\
\frac{1}{M}u - \frac{1}{M}D(x_2)
\end{bmatrix}\\
\end{align}\]</span></p>
<p>In the special case where air resistance is a linear function of <span class="math inline">\(x_2\)</span> (<span class="math inline">\(D(x_2)=d x_2\)</span>), then <span class="math inline">\(f(x,u)\)</span> becomes a linear function of <span class="math inline">\(x\)</span> and <span class="math inline">\(u\)</span>:</p>
<p><span class="math display">\[f(x,u) = \begin{bmatrix}
0 &amp; 1 \\
0 &amp; \frac{-d}{M}
\end{bmatrix} \begin{bmatrix}
x_1 \\
x_2
\end{bmatrix} + \begin{bmatrix}
0 \\
\frac{1}{M}
\end{bmatrix} u
\]</span></p>
<p>Define <span class="math inline">\(C = \begin{bmatrix}1 &amp; 0\end{bmatrix}\)</span>. In the linear case, we get:<br>
<span class="math display">\[\begin{align}
\dot{x} &amp;= Ax + Bu\\
y &amp;= Cx\\
\end{align}\]</span></p>
<p>This is a linear, time-invariant (LTI) model.</p>
<p><strong>Expect at least one question like this on the midterm</strong></p>
<h2 id="generalizing">Generalizing</h2>
<p>Generalizing, an important class of systems have models of the form:</p>
<p><span class="math display">\[\begin{align}
\dot{x} &amp;= f(x, u), &amp; f: \mathbb{R}^n \times \mathbb{R}^m \rightarrow \mathbb{R}^n\\
y &amp;= h(x, u), &amp; h: \mathbb{R}^n \times \mathbb{R}^m \rightarrow \mathbb{R}^p\\
\end{align}\]</span></p>
<ul>
<li>This model is nonlinear</li>
<li>there are <span class="math inline">\(m\)</span> control inputs <span class="math inline">\(u=(u_1, ..., u_m)\)</span>
</li>
<li>there are <span class="math inline">\(p\)</span> outputs <span class="math inline">\(y=(y_1,...,y_p)\)</span>
</li>
<li>the state vector <span class="math inline">\(x\)</span> has dimensions <span class="math inline">\(n\)</span>: <span class="math inline">\(x=(x_1, ..., x_n)\)</span>
</li>
</ul>
<p>The linear special case is:<br>
<span class="math display">\[\begin{align}
\dot{x} &amp;= Ax + Bu, &amp; A \in \mathbb{R}^{n \times m}\\
y &amp;= Cx + Du, &amp; C \in \mathbb{R}^{p \times m}\\
\end{align}\]</span></p>
<p>In this course, we look at single-input, single-output systems: <span class="math inline">\(m=p=1\)</span>.</p>
<h3 id="e.g.-more-carts">e.g. more carts</h3>
<p><img src="img/carts.png"></p>
<p><span class="math display">\[\begin{align}
m&amp;=2, &amp; u &amp;= (u_1, u_2)\\
p&amp;=2, &amp; y &amp;= (y_1, y_2)\\
m&amp;=4, &amp; x &amp;= (x_1, x_2, x_3, x_4) := (y_1, \dot{y_1}, y_2, \dot{y_2})\\
\end{align}\]</span></p>
<h3 id="e.g.-drones">e.g. drones</h3>
<p><img src="img/drones.png"><br>
<span class="math display">\[\begin{align}
u &amp;= (y_1, u_2, u_3, u_4)= (f_1, f_2, f_3, f_4)\\
p&amp;=3\\
y&amp;=(y_1, y_2, y_3)\\
x &amp;\in \mathbb{R}^{12} = (\text{position}, \text{orientation}, \text{velocity}, \text{angular velocity})\\
\end{align}\]</span></p>
<h3 id="determining-state">Determining state</h3>
<p>What is the state of a system?</p>
<p>The state vector <span class="math inline">\(x(t_0)\)</span> encapsulates all of the system's dynamics up to time <span class="math inline">\(t_0\)</span>.</p>
<p>More formally: For any two times <span class="math inline">\(t_0 \lt t\)</span>, knowing <span class="math inline">\(x(t_0)\)</span> and knowing <span class="math inline">\(\{u(t) : t_0 \le t \lt t_1\}\)</span>, we can compute <span class="math inline">\(x(t_1)\)</span> and <span class="math inline">\(y(t_1)\)</span>.</p>
<h3 id="e.g.-cart-with-no-forces">e.g. cart with no forces</h3>
<p><img src="img/cart-no-forces.png"></p>
<p>We know <span class="math inline">\(M\ddot{y} = 0\)</span> from Newton's laws.</p>
<p>If we try a 1-dimensional state, say <span class="math inline">\(x := y\)</span>, then knowing <span class="math inline">\(x(t_0)\)</span> without knowing <span class="math inline">\(\dot{y}\)</span> is not enough information to find the position in the future, <span class="math inline">\(x(t)\)</span> for <span class="math inline">\(t \gt t_0\)</span>. We have the same problem if we define <span class="math inline">\(x = \dot{y}\)</span>.</p>
<p>Since the governing equation is second order, we need two initial conditions. So, <span class="math inline">\(x=(y, \dot{y}) \in \mathbb{r}^2\)</span> is a good choice.</p>
<p>In general, it is a good idea to use:</p>
<ul>
<li>position and velocity for a physical system</li>
<li>Capacitor voltage and inductor current for a circuit</li>
</ul>
<h3 id="e.g.-2.5.2-pendulum">e.g. 2.5.2: Pendulum</h3>
<p><img src="img/pendulum.png"></p>
<p>Model: <span class="math inline">\(\ddot{\theta} = \frac{3}{Ml^2} u - 3\frac{g}{l} \sin(\theta)\)</span></p>
<p>In state space form:<br>
<span class="math display">\[\begin{align}
x &amp;= (\theta, \dot{\theta})\\
y &amp;= \text{angular position} = \theta\\
\\
\dot{x}&amp;=f(x,u) \quad &amp; &amp; \dot{x_1}=x_2\\
\dot{y}&amp;=h(x,u) \quad &amp; &amp; \dot{x_2}=\frac{3}{Ml^2}u - 3\frac{s}{l} \sin(x_1)\\
&amp; &amp; &amp; y = x_1
\end{align}\]</span></p>
<p>This is nonlinear due to the sine term.</p>
<h3 id="e.g.-2.4.5-circuit">e.g. 2.4.5 Circuit</h3>
<p><img src="img/circuit.png"></p>
<p><span class="math display">\[\begin{align}
x_1 &amp;:= \text{voltage across capacitor} = \frac{1}{C} \int{y(\tau)d\tau}\\
x_2 &amp;:= \text{current through inductor} = y\\
\\
-u + V_R + V_C + V_L &amp;= 0\\
\Rightarrow -u + Rx_2  + x_1 + L\dot{x_2} &amp;= 0, \quad \text{from capacitor equation: } \dot{x_1}=\frac{1}{C} x_2\\
\\
\dot{x} &amp;= \begin{bmatrix}
0 &amp; \frac{1}{C}\\
\frac{-1}{2} &amp; \frac{-R}{L}\end{bmatrix} \begin{bmatrix}x_1\\
x_2\end{bmatrix} + \begin{bmatrix}0 \\ \frac{1}{L}\end{bmatrix} u\\
y &amp;= \begin{bmatrix}0 &amp; 1\end{bmatrix}\\
\end{align}\]</span></p>
<h2 id="linearization">Linearization</h2>
<p>This is the process of aproximating a nonlinear state-space model with a linear model.</p>
<h3 id="e.g.-2.5.2">e.g. 2.5.2</h3>
<p>Linearize <span class="math inline">\(y=x^3\)</span> at the point <span class="math inline">\(\bar{x}=1\)</span>.</p>
<p><img src="img/linearize.png"></p>
<p>Let <span class="math inline">\(\bar{y} := f(\bar{x}) = 1^3 = 1\)</span></p>
<p>Taylor series at <span class="math inline">\(x=\bar{x}\)</span> is:<br>
<span class="math display">\[y=\sum_{n=0}^\infty c_n (x-\bar{x})^n, \quad c_n = \frac{1}{n!} \frac{d^n f(x)}{dx^n} \biggr|_{x=\bar{x}}\]</span></p>
<p>Keep only the terms <span class="math inline">\(n=0\)</span> and <span class="math inline">\(n=1\)</span>:<br>
<span class="math display">\[\begin{align}
f(x) &amp;\approx f(\bar{x}) + \frac{df(x)}{dx}\biggr|_{x-\bar{x}} (x-\bar{x})\\
y - \bar{y} &amp;\approx + \frac{df(x)}{dx}\biggr|_{x-\bar{x}} (x-\bar{x})\\
\end{align}\]</span></p>
<p>If we define the derivations <span class="math inline">\(\partial y := y - \bar{y}, \partial x := x - \bar{x}\)</span>, then <span class="math inline">\(\partial y = \frac{df}{dx} \bigg|_{x=\bar{x}} \partial x\)</span>, i.e. <span class="math inline">\(\partial y = 3 \partial x\)</span></p>
<h3 id="e.g.-2.5.3">e.g. 2.5.3</h3>
<p><span class="math display">\[y = \begin{bmatrix}y_1 \\ y_2\end{bmatrix} = f(x) = \begin{bmatrix}x_1 x_2 - 1 \\ x_3^2 - 2x_1 x_3\end{bmatrix} =: \begin{bmatrix}f_1(x) \\ f_2(x)\end{bmatrix}\]</span></p>
<p>Linearize at <span class="math inline">\(\bar{x}=(1, -1, 2)\)</span>.</p>
<p><span class="math inline">\(\bar{y}=f(\bar{x})=\begin{bmatrix}-2\\0\end{bmatrix}\)</span></p>
<h2 id="multivariable-taylor-series">Multivariable Taylor series</h2>
<p><span class="math display">\[d(x)=f(\bar{x})+\frac{\partial f}{\partial x} \biggr|_{x=\bar{x}} (x-\bar{x}) \text{ + higher order terms}\]</span></p>
<p>The Jacobian of <span class="math inline">\(f\)</span> at <span class="math inline">\(\bar{x}\)</span> is:<br>
<span class="math display">\[\begin{align}
\frac{\partial f}{\partial x} \biggr|_{x = \bar{x}}
&amp;= \begin{bmatrix}
  \frac{\partial f_1}{\partial x_1} &amp; \frac{\partial f_1}{\partial x_2} &amp; \frac{\partial f_1}{\partial x_3} \\
  \frac{\partial f_2}{\partial x_1} &amp; \frac{\partial f_2}{\partial x_2} &amp; \frac{\partial f_2}{\partial x_3} \\
  \frac{\partial f_3}{\partial x_1} &amp; \frac{\partial f_3}{\partial x_2} &amp; \frac{\partial f_3}{\partial x_3} \\
\end{bmatrix}\\
&amp;= \begin{bmatrix}
  x_2 &amp; x_1 &amp; 0 \\
  -2x_3 &amp; 0 &amp; 2x_3-2x_1 \\
\end{bmatrix}_{x=(1, -1, 2)}\\
&amp;= \begin{bmatrix}
  -1 &amp; 1 &amp; 0\\
  -4 &amp; 0 &amp; 2
\end{bmatrix}\\
&amp;= A
\end{align}\]</span></p>
<p>i.e. <span class="math inline">\(y-\bar{y} \approx A(x-\bar{x})\)</span></p>
<p>By extension, near <span class="math inline">\((x,u)=(\bar{x}, \bar{u})\)</span>:<br>
<span class="math display">\[f(x, u) \approx f(\bar{x}, \bar{u})+ \frac{\partial f}{\partial x} \biggr|_{(x,u)=(\bar{x}, \bar{u})} (x-\bar{x}) + \frac{\partial f}{\partial u} \biggr|_{(x,u)=(\bar{x}, \bar{u})} (u-\bar{u})\]</span></p>
<p>Let's apply this to <span class="math inline">\(\dot{x}=f(x,u), y=h(x,u)\)</span>.</p>
<p><strong>Definition:</strong> A constant pair <span class="math inline">\((\bar{x}, \bar{u}) \in \mathbb{R}^n \times \mathbb{R}^m\)</span> is an <strong>equilibrium configuration</strong> of the system <span class="math inline">\(\dot{x}=f(x,u), y=h(x,u)\)</span> if <span class="math inline">\(f(\bar{x}, \bar{u})=(0,...,0)\)</span>. The constant <span class="math inline">\(\bar{x}\)</span> is the <strong>equilibrium point.</strong></p>
<h3 id="e.g.-find-all-the-equilibria-at-which-the-pendulum-is-upright">e.g. Find all the equilibria at which the pendulum is upright</h3>
<p><span class="math display">\[\begin{align}
\dot{x} &amp;= f(x,u)\\
y &amp;= h(x,u)\\
x_1 &amp;= \theta\\
x_2 &amp;= \dot{\theta}\\
f(x,u) &amp;= \begin{bmatrix}x_2\\ \frac{3}{Ml}u-\frac{3g}{l}\sin(x_1)\end{bmatrix}\\
h(x) &amp;= x_1
\end{align}\]</span></p>
<p>If <span class="math inline">\(y=\pi\)</span> (upright), then <span class="math inline">\(\bar{x_1}=\pi\)</span>. So we have to solve:<br>
<span class="math display">\[
\begin{bmatrix}0\\0\end{bmatrix} = \begin{bmatrix}
  \bar{x_2}\\
  \frac{3\bar{u}}{Ml} - \frac{3g}{l}\sin(\bar{x_1})
\end{bmatrix} \Rightarrow \bar{x_2}=0, \quad \bar{u}=0
\]</span></p>
<p>Therefore the equilibria are:<br>
<span class="math display">\[
\begin{bmatrix}\bar{x_1}\\\bar{x_2}\end{bmatrix} = \begin{bmatrix}\pi + 2\pi k \\ 0\end{bmatrix}, \quad \bar{u}=0
\]</span></p>
<p>Assume that <span class="math inline">\(\dot{x}=f(x,u)\)</span> has an equilibrium configuration at <span class="math inline">\((x,u)=(\bar{x}, \bar{u})\)</span>.</p>
<p><span class="math display">\[
f(x,u) \approx \underbrace{f(\bar{x}, \bar{u})}_{=0} + \underbrace{\frac{\partial f}{\partial x} \biggr|_{(x,u)=(\bar{x}, \bar{u})} (x - \bar{x})}_{=: A} + \underbrace{\frac{\partial f}{\partial u} \biggr|_{(x,u)=(\bar{x}, \bar{u})} (u - \bar{u})}_{=:B}\]</span></p>
<p>Consider deviations from <span class="math inline">\((\bar{x}, \bar{u})\)</span>, where <span class="math inline">\(||\partial x||, ||\partial u||\)</span> are assumed to be small:<br>
<span class="math display">\[\begin{align}
\partial x(t) &amp;:= x(t) - \bar{x}\\
\partial u(t) &amp;:= u(t) - \bar{u}\\
\end{align}\]</span></p>
<p>Then we get linearized state equations:<br>
<span class="math display">\[\dot{\partial x} = \dot{x} - 0 = f(x,u) \approx A\partial x + B \partial u\\
\dot{\partial x} = A\partial x + B\partial u\]</span></p>
<p>Linearized output equation:</p>
<p><span class="math display">\[\partial y = \underbrace{\frac{\partial h}{\partial x} \biggr|_{(x,u)=(\bar{x},\bar{u})} \partial x}_{=:C} + \underbrace{\frac{\partial h}{\partial u} \biggr|_{(x,u)=(\bar{x},\bar{u})} \partial u}_{=:D}\\
\partial y := y-\bar{y}=y-h(\bar{x},\bar{u})\]</span></p>
<h3 id="summary">Summary</h3>
<p>Linearizing <span class="math inline">\(\dot{x}=f(x,u)\)</span> and <span class="math inline">\(y=h(x,u)\)</span>:</p>
<ol>
<li>Select an equilibrium configuration <span class="math inline">\((\bar{x}, \bar{u}) \in \mathbb{R}^n \times \mathbb{R}^m\)</span>: <span class="math inline">\(\bar{y}=h(\bar{x},\bar{u}), f(\bar{x},\bar{u})=0\)</span>
</li>
<li>Compute Jacobians of <span class="math inline">\(f,h\)</span> to get <span class="math inline">\(A,B,C,D\)</span>
</li>
<li>Linearization: <span class="math inline">\(\dot{\partial x} = A \partial + B \partial u, \partial y = C \partial x + D \partial u\)</span>
</li>
</ol>
<div id="footer">
  Notes by <a href="http://www.davepagurek.com">Dave Pagurek</a>. Contribute <a href="https://github.com/davepagurek/SE-Notes">on GitHub</a>.
</div>
</body>
</html>
